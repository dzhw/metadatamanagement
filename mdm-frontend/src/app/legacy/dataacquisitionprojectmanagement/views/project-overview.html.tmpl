<div class="fdz-cc">
  <md-content layout="column" layout-align="start stretch">
    <md-card>
      <md-card-header>
        <md-card-header-text>
          <h1 class="md-headline fdz-truncate-string" id="top">
            {{'data-acquisition-project-management.project-overview.header' | translate}}
          </h1>
        </md-card-header-text>
      </md-card-header>
      <!-- Search/Filters -->
      <div>
        <md-card class="pa0 db">
            <md-tabs md-selected="ctrl.selectedTabIndex" md-dynamic-height md-border-bottom>
                <md-tab ng-repeat="tab in tabs" md-on-select="ctrl.onSelectedTabChanged(tab)" ng-disabled="tab.disabled">
                    <md-tab-label>
                        <span>{{tab.title|translate}} {{tab.count != null? '(' + tab.count + ')' : ''}}</span>
                      <span ng-if="tab.group && currentProject && !currentProject.released && hasAnyAuthority(['ROLE_PUBLISHER','ROLE_DATA_PROVIDER']) && tab.group !== 'concepts'" ng-switch="getSentimentValue(tab.group)">
                                <span ng-switch-when="0">
                                    <md-icon md-svg-src="assets/images/icons/clipboard.svg"></md-icon>
                                </span>
                                <span ng-switch-when="1">
                                    <md-icon md-svg-src="assets/images/icons/clipboard-check.svg"></md-icon>
                                </span>
                                <span ng-switch-when="2">
                                    <md-icon md-svg-src="assets/images/icons/clipboard-double-check.svg"></md-icon>
                                </span>
                            </span>
                        <md-tooltip md-direction="top" md-autohide="true" md-z-index="bowser.msie || bowser.msedge || bowser.mobile || bowser.tablet ? -100 : 100001">{{tab.title+'-tooltip'|translate}}</md-tooltip>
                    </md-tab-label>
                </md-tab>
            </md-tabs>
            <!-- Search Bar -->
            <form role="search" ng-submit="hideMobileKeyboard($event)">
                <md-autocomplete class="ma8" md-search-text="ctrl.searchText" 
                  md-selected-item="ctrl.selectedProject" 
                  md-selected-item-change="ctrl.search()" 
                  md-items="project in ctrl.searchProjects(ctrl.searchText)" 
                  md-item-text="project.id"
                  md-clear-button="!ctrl.projectChooserDisabled" 
                  md-min-length="0" 
                  md-delay="250" 
                  placeholder="{{'global.menu.entities.search-project' | translate}}" 
                  md-select-on-match="true" 
                  md-no-cache="true">
                    <md-item-template>
                        <span md-highlight-text="ctrl.searchTerm">{{project.id}}</span>
                    </md-item-template>
                    <md-not-found>
                        <span data-translate="global.menu.entities.unknown-project" data-translate-values="{projectId: ctrl.searchText}"></span>
                    </md-not-found>
                </md-autocomplete>
                <!-- ASSIGNED GROUP -->
                <md-input-container flex class="ma8 w-20" ng-style="!selectedFilters || selectedFilters.length === 0 ? {'margin-right':'16px'} : {}">
                  <md-icon md-svg-src="/assets/images/icons/filter.svg"></md-icon>
                  <label>Zugewiesen an</label>
                  <md-select ng-model="ctrl.selectedAssignedGroup" ng-change="ctrl.search()">
                      <md-option value="" ng-click="closeSelectMenu()"></md-option>
                        <md-option value="DATA_PROVIDER" ng-click="closeSelectMenu()">Dataprovider</md-option>
                        <md-option value="PUBLISHER" ng-click="closeSelectMenu()">Publisher</md-option>
                  </md-select>
                </md-input-container>
                <!-- RELEASE STATE -->
                <md-input-container flex class="ma8 w-20" ng-style="!selectedFilters || selectedFilters.length === 0 ? {'margin-right':'16px'} : {}">
                  <label>Status</label>
                  <md-select ng-model="ctrl.selectedReleaseState" ng-change="ctrl.search()">
                    <md-content class="md-select-menu-ie11-fix">
                        <md-option value="" ng-click="closeSelectMenu()"></md-option>
                        <md-option value="true" ng-click="selectedFilters.indexOf(filter) === -1 && closeSelectMenu()">Freigegeben</md-option>
                        <md-option value="false" ng-click="selectedFilters.indexOf(filter) === -1 && closeSelectMenu()">Nicht freigegeben</md-option>
                    </md-content>
                  </md-select>
                </md-input-container>
                <!-- Filters Datapackage -->
                <md-input-container ng-if="ctrl.currentTab.group === 'dataPackages'" flex class="ma8 w-20">
                  <label>Filter f√ºr Datenpakete</label>
                  <md-select ng-model="ctrl.selectedFiltersDataPackage" multiple ng-change="ctrl.search()">
                    <md-content class="md-select-menu-ie11-fix">
                        <md-option value="Variables">Variablen</md-option>
                        <md-option value="Questions">Fragen</md-option>
                        <md-option value="Publications">Publikationen</md-option>
                        <md-option value="Concepts">Konzepte</md-option>
                    </md-content>
                  </md-select>
                </md-input-container>
                <!-- Additional Info -->
                <md-input-container ng-if="ctrl.currentTab.group === 'dataPackages'" flex class="ma8 w-20">
                  <label>Zusatzangaben</label>
                  <md-select ng-model="ctrl.selectedAdditionalInfo" ng-change="ctrl.search()">
                      <md-option value="" ng-click="closeSelectMenu()"></md-option>
                      <md-option value="true" ng-click="closeSelectMenu()">mit Zusatzangaben</md-option>
                      <md-option value="false" ng-click="closeSelectMenu()">ohne Zusatzangaben</md-option>
                  </md-select>
                </md-input-container>
            </form>
            <!-- <md-progress-linear ng-if="!tabs[searchParams.selectedTabIndex].elasticSearchType" md-mode="indeterminate" ng-disabled="!ctrl.isSearching"></md-progress-linear> -->
        </md-card>
      </div>
      <!-- Check if currently any projects are assigned to currently logged in user -->
      <div ng-switch="ctrl.userHasProjects">
        <!-- user with projects -->
        <md-card-content ng-switch-when="true" card="pa0">
          <div ng-switch="ctrl.overview.data.length > 0">
            <table ng-switch-when="true" class="table-striped table-hover" fdz-table>
              <thead class="">
              <tr>
                <th>{{'data-acquisition-project-management.project-overview.table.project-name' | translate}}</th>
                <th>{{'data-acquisition-project-management.project-overview.table.release-version' | translate}}</th>
                <th>{{'data-acquisition-project-management.project-overview.table.assigned-group' | translate}}</th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.data-package-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.analysis-package-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.surveys-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.instruments-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.data-sets-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.questions-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.variables-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.publications-status' | translate}}&nbsp;
                </th>
                <th class="fdz-project-status-overview-metadata-status-table-cell">
                  {{'data-acquisition-project-management.project-overview.table.concepts-status' | translate}}&nbsp;
                </th>
              </tr>
              </thead>
              <tbody>
              <tr ng-click="ctrl.openProjectCockpit(dataAcquisitionProject.id)"
                  ng-repeat="dataAcquisitionProject in ctrl.overview.data">
                <td class="fdz-table-data-vertical-middle">
                  {{::dataAcquisitionProject.id}}
                  <md-tooltip md-autohide="true" md-direction="top"
                              md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'data-acquisition-project-management.project-overview.table.tooltip'| translate}}
                  </md-tooltip>
                </td>
                <td class="fdz-table-data-vertical-middle">{{::dataAcquisitionProject.release.version ?
                  dataAcquisitionProject.release.version :
                  ('data-acquisition-project-management.project-overview.table.unreleased' | translate)}}&nbsp;
                </td>
                <td class="fdz-table-data-vertical-middle" ng-switch="dataAcquisitionProject.assigneeGroup">
                  <span ng-switch-when="PUBLISHER">{{'data-acquisition-project-management.project-overview.table.publisher' | translate}}</span>
                  <span ng-switch-when="DATA_PROVIDER">{{'data-acquisition-project-management.project-overview.table.data-provider' | translate}}</span>
                  <span ng-switch-default>&nbsp;</span>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'DataPackages'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'AnalysisPackages'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'Surveys'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'Instruments'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'DataSets'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'Questions'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'Variables'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'Publications'"></metadata-status>
                </td>
                <td class="fdz-table-data-vertical-middle">
                  <metadata-status project="dataAcquisitionProject" type="'Concepts'"></metadata-status>
                </td>
              </tr>
              </tbody>
            </table>
            <div ng-switch-when="true" layout="column" layout-align="start center">
              <ul boundary-link-numbers="true"
                  class="pagination-sm"
                  items-per-page="ctrl.pagination.itemsPerPage"
                  next-text="{{'global.pagination.next'|translate}}"
                  ng-change="ctrl.onPageChange()"
                  ng-model="ctrl.pagination.selectedPageNumber"
                  previous-text="{{'global.pagination.previous'|translate}}"
                  template-url="scripts/common/pagination/custom-uib-pagination.html.tmpl"
                  total-items="ctrl.pagination.totalItems"
                  uib-pagination>
              </ul>
            </div>
            <span ng-switch-when="false" data-translate="data-acquisition-project-management.project-overview.no-search-results-msg"></span>
          </div>
        </md-card-content>
        <div ng-switch-when="false">
          <!-- user without projects or just no search results? -->
          <span data-translate="data-acquisition-project-management.project-overview.no-project-msg"></span>
        </div>
      </div>
    </md-card>
  </md-content>
</div>
