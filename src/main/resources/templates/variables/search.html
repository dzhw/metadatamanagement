<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head th:include="common/head::head">
</head>
<body class="body-with-pageheader">
	<header>
		<div th:include="common/navbar::navbar"></div>
		<div
			th:include="common/pageHeader::pageHeader(title=#{variables.search.title},subtitle='')"></div>
	</header>
	<form id="searchForm" class="data-pjax" action="#"
		th:object="${variableSearchFilter}" name="searchVariables"
		th:action="${resource.variableSearchLink.href}" autocomplete="off">
		<div class="container">
			<div class="row">
				<!-- SearchBox -->
				<div class="col-md-9 col-md-offset-3">
					<div class="row">
						<div class="col-md-12">
							<div class="panel panel-primary">
								<div class="panel-body">
									<div class="input-group">
										<label class="sr-only" for="query"
											th:text="#{variables.search.searchinput.placeholder}">Search
											for Variables</label> <input type="text"
											class="form-control pjax-input" id="query" th:attr="data-suggest-url=${resource.suggestLink.href}"
											th:field="*{query}"
											th:placeholder="#{variables.search.searchinput.placeholder}" />
										<span class="input-group-btn">
											<button type="submit" class="btn btn-default">
												<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
				<!-- Results and Filter area -->
				<div id="pjax-container">
					<div class="col-md-12" id="searchResults"
						th:object="${variableSearchFilter}">
						<div class="row">
							<!-- Filter -->
							<div class="col-md-3">
								<!-- Survey Title Filter -->
								<div class="panel panel-default">
									<div class="panel-heading custom-panel-heading"
										data-toggle="collapse" data-target="#collapseSurveyTitlePanel">
										<a class="panel-title panel-toggle"
											href="#collapseSurveyTitlePanel" data-toggle="collapse"
											th:text="#{variables.common.variable.surveyTitle}">Survey
											Title </a>
									</div>
									<div id="collapseSurveyTitlePanel"
										class="panel-collapse collapse fade in">
										<ul class="list-group">
											<li class="list-group-item"
												th:each="surveyTitle : ${surveyTitleBuckets}">
												<div class="checkbox">
													<label class="text-capitalize label-with-text-and-badge"><input
														type="checkbox" th:field="*{surveyTitle}"
														th:value="${surveyTitle.key}" class="pjax-filter" /> <span
														class="abbreviated-text" th:text="${surveyTitle.key}"></span>
													</label><span class="badge pull-right"
														th:text="${surveyTitle.docCount}">14</span>
												</div>
											</li>
										</ul>
									</div>
								</div>
								<!-- Survey Period -->
								<div class="panel panel-default">
									<div class="panel-heading custom-panel-heading"
										data-toggle="collapse" data-target="#collapseDateRangePanel">
										<a class="panel-title panel-toggle"
											href="#collapseDateRangePanel" data-toggle="collapse"
											th:text="#{variables.common.variable.survey.period}">DateRange
										</a>
									</div>
									<div id="collapseDateRangePanel"
										class="panel-collapse collapse fade in">
										<ul class="list-group">
											<li class="list-group-item">
												<div
													th:replace="common/errorAlerts::globalAlerts(field=surveyPeriod)"></div>
												<div
													th:replace="common/calendar::date(field=surveyPeriod.startDate,label=#{variables.common.variable.survey.period.start},placeholder=#{variables.common.variable.survey.period.start},readonly=false)"></div>
												<div
													th:replace="common/calendar::date(field=surveyPeriod.endDate,label=#{variables.common.variable.survey.period.end},placeholder=#{variables.common.variable.survey.period.end},readonly=false)"></div>

											</li>
										</ul>
									</div>
								</div>
								<!-- Scale Level Filter -->
								<div class="panel panel-default">
									<div class="panel-heading custom-panel-heading"
										data-toggle="collapse" data-target="#collapseScaleLevelPanel">
										<a class="panel-title panel-toggle"
											href="#collapseScaleLevelPanel" data-toggle="collapse"
											th:text="#{variables.common.variable.scaleLevel}">ScaleLevel
										</a>
									</div>
									<div id="collapseScaleLevelPanel"
										class="panel-collapse collapse fade in">
										<ul class="list-group">
											<li class="list-group-item"
												th:each="scaleLevel : ${scaleLevelBuckets}">
												<div class="checkbox">
													<label class="text-capitalize"><input
														type="checkbox" th:field="*{scaleLevel}"
														th:value="${scaleLevel.key}" class="pjax-filter" /> <span
														th:text="${scaleLevel.key}"></span> </label><span
														class="badge pull-right" th:text="${scaleLevel.docCount}">14</span>
												</div>
											</li>
										</ul>
									</div>
								</div>
							</div>
							<!-- result and page -->
							<div class="col-md-9">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<span class="panel-title"
											th:text="${resource.page.metadata.totalElements}>0?#{variables.search.numberOfResults(${resource.page.metadata.totalElements},${resource.page.metadata.number}*${resource.page.metadata.size}+1,${resource.page.metadata.number}*${resource.page.metadata.size}+${resource.page.content.size()})}:#{variables.search.noresults}">100
											Variablen gefunden </span>
									</div>
									<ul class="list-group">
										<li th:if="${resource.page.content.size() gt 0}"
											class="list-group-item search-result"
											th:each="variable : ${resource.page}">
											<h4 class="list-group-item-heading">
												<a th:href="${variable.id.href}" th:if="${variable.variableDocument.isFieldHighlighted('label')} == false"
													th:text="${variable.variableDocument.label}"> </a>
												<a th:href="${variable.id.href}" th:if="${variable.variableDocument.isFieldHighlighted('label')} == true"
													th:utext="${variable.variableDocument.highlightedFields.get('label')}"> </a>	
											</h4>
											<p class="list-group-item-text"
												th:if="${variable.variableDocument.isFieldHighlighted('name')} == false"
												th:text="#{variables.search.name(${variable.variableDocument.name})}"></p>
											<p class="list-group-item-text"
												th:if="${variable.variableDocument.isFieldHighlighted('name')} == true"
												th:utext="#{variables.search.name(${variable.variableDocument.highlightedFields.get('name')})}"></p>

											<p class="list-group-item-text"
												th:if="${variable.variableDocument.isFieldHighlighted('question')} == false"
												th:text="#{variables.search.question(${variable.variableDocument.question})}"></p>
											<p class="list-group-item-text"
												th:if="${variable.variableDocument.isFieldHighlighted('question')} == true"
												th:utext="#{variables.search.question(${variable.variableDocument.highlightedFields.get('question')})}"></p>

											<p class="list-group-item-text"
												th:if="${variable.variableDocument.isFieldHighlighted('variableSurvey.title')} == false"
												th:text="#{variables.search.survey(${variable.variableDocument.variableSurvey.title})}"></p>
											<p class="list-group-item-text"
												th:if="${variable.variableDocument.isFieldHighlighted('variableSurvey.title')} == true"
												th:utext="#{variables.search.survey(${variable.variableDocument.highlightedFields.get('variableSurvey.title')})}"></p>
										</li>
										<li th:if="${resource.page.content.size() == 0}"
											class="list-group-item">
											<p class="list-group-item-text"
												th:text="#{variables.search.noresults}"></p>
										</li>
										<li class="list-group-item"
											th:if="${resource.page.content.size() gt 0}">
											<ul class="pager">
												<li class="previous"
													th:classappend="${resource.page.previousLink==null?'disabled':''}"><a
													th:href="${resource.page.previousLink?.href?:'javascript:;'}">&larr;
														<span th:text="#{common.pager.previous}"></span>
												</a></li>
												<li class="hidden-xs"><a> <span
														th:text="#{common.pagenumbers(${resource.page.metadata.number}+1,${resource.page.metadata.totalPages})}"></span>
												</a></li>
												<li class="next"
													th:classappend="${resource.page.nextLink==null?'disabled':''}"><a
													th:href="${resource.page.nextLink?.href?:'javascript:;'}"><span
														th:text="#{common.pager.next}"></span> &rarr;</a></li>
											</ul>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<div th:include="common/js_libraries::js"></div>
	<script src="/js/search.js"></script>
	<script src="/js/variables/datepicker.js"></script>
</body>
</html>
