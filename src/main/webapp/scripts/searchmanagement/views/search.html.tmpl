<div flex layout="column" ng-switch="isAuthenticated()">
    <md-card style="margin-bottom: 0px">
        <div class="fdz-search-input-container">
            <md-input-container class="fdz-search-input">
                <label>{{tabs[selectedTabIndex].inputLabel|translate}}</label>
                <md-icon md-font-set="material-icons">search</md-icon>
                <input id="query" type="text" ng-model="searchParams.query" ng-model-options="{debounce: 100}" ng-change="onQueryChanged()" autocomplete="off">
            </md-input-container>
            <md-tabs md-selected="selectedTabIndex" md-dynamic-height>
                <md-tab ng-repeat="tab in tabs" md-on-select="onTabSelected()">
                    <md-tab-label>
                        <md-icon ng-if="tab.icon" md-svg-icon="{{tab.icon}}"></md-icon>
                        <span>{{tab.title|translate}}
                            {{tab.count != null? '(' + tab.count + ')' : ''}}</span>
                    </md-tab-label>
                </md-tab>
            </md-tabs>
        </div>
        <md-progress-linear md-mode="indeterminate" ng-if="isSearching"></md-progress-linear>
    </md-card>
    <div flex ngf-drop="tabs[selectedTabIndex].uploadFunction($files)" ngf-multiple="true" ngf-drag-over-class="{accept:'fdz-file-drop-accept', delay:0}" ngf-drop-disabled="(!currentProject && tabs[selectedTabIndex].elasticSearchType !== 'related_publications') || !isAuthenticated() || !tabs[selectedTabIndex].uploadFunction">
        <div ng-repeat="result in searchResult" ng-switch="result._type">
            <variable-search-result ng-switch-when="variables" search-result="result._source"></variable-search-result>
            <survey-search-result ng-switch-when="surveys" search-result="result._source"></survey-search-result>
            <question-search-result ng-switch-when="questions" search-result="result._source"></question-search-result>
            <dataset-search-result ng-switch-when="data_sets" search-result="result._source"></dataset-search-result>
            <study-search-result ng-switch-when="studies" search-result="result._source"></study-search-result>
            <related-publication-search-result ng-switch-when="related_publications" search-result="result._source"></related-publication-search-result>
            <instrument-search-result ng-switch-when="instruments" search-result="result._source"></instrument-search-result>
        </div>

        <div ng-if="pageObject.totalHits" layout="row" layout-align="center">
            <ul
                uib-pagination
                next-text="{{'global.pagination.next'|translate}}"
                previous-text="{{'global.pagination.previous'|translate}}"
                total-items="pageObject.totalHits"
                ng-model="pageObject.page"
                max-size="5"
                ng-change="onPageChanged()"
                items-per-pageObject="pageObject.size"
                class="pagination-sm"></ul>
        </div>
    </div>
    <div ng-switch-when="true" has-any-authority="ROLE_ADMIN, ROLE_USER" class="fdz-fab-button-container" layout="column">
        <md-button aria-label="{{'search-management.buttons.refresh' | translate}}" class="md-primary md-fab" ng-click="refresh()" style="margin-bottom: 1em;">
            <md-tooltip md-direction="left">
                {{'search-management.buttons.refresh' | translate}}
            </md-tooltip>
            <md-icon md-font-set="material-icons">refresh</md-icon>
        </md-button>
        <!-- Index 1 = Study Tab -->
        <md-button
            aria-label="{{'search-management.buttons.upload-studies' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='studies'"
            type="file"
            ngf-select="uploadStudy($files)"
            ngf-multiple="true"
            class="md-accent md-fab"
            directory webkitdirectory
            ng-disabled="!currentProject">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-studies' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
        <!-- Index 2 = Questions Tab -->
        <md-button
            aria-label="{{'search-management.buttons.upload-questions' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='questions'"
            type="file"
            ngf-select="uploadQuestions($files)"
            ngf-multiple="true"
            class="md-accent md-fab"
            directory webkitdirectory
            ng-disabled="!currentProject">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-questions' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
        <md-button
            aria-label="{{'search-management.buttons.upload-variables' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='variables'"
            type="file"
            ngf-select="uploadVariables($files)"
            class="md-accent md-fab"
            ngf-multiple="true"
            directory webkitdirectory
            ng-disabled="!currentProject">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-variables' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
        <md-button
            aria-label="{{'search-management.buttons.upload-surveys' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='surveys'"
            type="file"
            ngf-select="uploadSurveys($files)"
            class="md-accent md-fab"
            ngf-multiple="true"
            directory webkitdirectory
            ng-disabled="!currentProject">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-surveys' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
        <md-button
            aria-label="{{'search-management.buttons.upload-data-sets' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='data_sets'"
            type="file"
            ngf-select="uploadDataSets($files)"
            class="md-accent md-fab"
            ngf-multiple="true"
            directory webkitdirectory
            ng-disabled="!currentProject">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-data-sets' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
        <md-button
            aria-label="{{'search-management.buttons.upload-instruments' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='instruments'"
            type="file"
            ngf-select="uploadInstruments($files)"
            class="md-accent md-fab"
            ngf-multiple="true"
            directory webkitdirectory
            ng-disabled="!currentProject">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-instruments' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
        <md-button
            aria-label="{{'search-management.buttons.upload-related-publications' | translate}}"
            ng-if="tabs[selectedTabIndex].elasticSearchType==='related_publications'"
            type="file"
            ngf-select="uploadRelatedPublications($file)"
            accept=".xls"
            class="md-accent md-fab">
            <div>
                <md-tooltip md-direction="left">
                    {{'search-management.buttons.upload-related-publications' | translate}}
                </md-tooltip>
                <md-icon md-font-set="material-icons">add</md-icon>
            </div>
        </md-button>
    </div>
</div>
