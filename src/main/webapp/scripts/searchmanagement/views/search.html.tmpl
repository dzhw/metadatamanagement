<jh-alert></jh-alert>
<div ng-switch="isAuthenticated()">
    <md-card class="fdz-search-input-container">
        <md-input-container class="fdz-search-input">
            <label>{{'global.menu.search.title'|translate}}</label>
            <input id="query" type="text" ng-model="query" ng-change="onQueryChanged()" autocomplete="off">
            <md-icon md-font-set="material-icons">search</md-icon>
        </md-input-container>
        <md-tabs md-selected="selectedTabIndex" md-dynamic-height>
            <md-tab ng-repeat="tab in tabs" md-on-select="onTabSelected()">
                <md-tab-label>
                    <md-icon ng-if="tab.icon" md-svg-icon="{{tab.icon}}"></md-icon>
                    <span>{{tab.title|translate}}
                        {{tab.count != null? '(' + tab.count + ')' : ''}}</span>
                </md-tab-label>
            </md-tab>
        </md-tabs>
    </md-card>
    <div ng-repeat="result in searchResult" ng-switch="result._type">
        <variable-search-result ng-switch-when="variables" search-result="result._source"></variable-search-result>
        <survey-search-result ng-switch-when="surveys" search-result="result._source"></survey-search-result>
        <question-search-result ng-switch-when="atomic_questions" search-result="result._source"></question-search-result>
        <dataset-search-result ng-switch-when="data_sets" search-result="result._source"></dataset-search-result>
    </div>
    <div ng-if="page.totalHits" layout="row" layout-align="center">
        <uib-pagination next-text="{{'pagination.next'|translate}}" previous-text="{{'pagination.previous'|translate}}" total-items="page.totalHits" ng-model="page.currentPageNumber" max-size="5" ng-change="throttledSearch()" class="pagination-sm"></uib-pagination>
    </div>
    <div ng-switch-when="true" has-any-authority="ROLE_ADMIN, ROLE_USER" class="fdz-fab-button-container" layout="column">
        <md-button class="md-primary md-fab" ng-click="refresh()" style="margin-bottom: 1em;">
            <md-icon md-font-set="material-icons">refresh</md-icon>
        </md-button>
        <!-- Index 1 = Variables Tab -->
        <md-button ng-if="selectedTabIndex===1" type="file" ngf-select="uploadVariables($file)" class="md-accent md-fab" accept=".zip" ng-disabled="!currentProject">
            <md-icon md-font-set="material-icons">add</md-icon>
        </md-button>
        <!-- Index 2 = Questions Tab -->
        <md-button ng-if="selectedTabIndex===2" type="file" ngf-select="uploadQuestions($file)" class="md-accent md-fab" accept=".xlsx" ng-disabled="!currentProject">
            <md-icon md-font-set="material-icons">add</md-icon>
        </md-button>
        <!-- Index 3 = Surveys Tab -->
        <md-button ng-if="selectedTabIndex===3" type="file" ngf-select="uploadSurveys($file)" class="md-accent md-fab" accept=".xlsx" ng-disabled="!currentProject">
            <md-icon md-font-set="material-icons">add</md-icon>
        </md-button>
        <!-- Index 4 = Data Sets Tab -->
        <md-button ng-if="selectedTabIndex===4" type="file" ngf-select="uploadDataSets($file)" class="md-accent md-fab" accept=".xlsx" ng-disabled="!currentProject">
            <md-icon md-font-set="material-icons">add</md-icon>
        </md-button>
    </div>
</div>
